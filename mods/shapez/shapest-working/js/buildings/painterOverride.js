import { SzColorItem } from "../shapest/color.js";
import { SzShapeItem } from "../shapest/item.js";
import { ColorItem, defaultBuildingVariant, enumDirection, enumPainterVariants, MetaPainterBuilding, MOD_ITEM_PROCESSOR_HANDLERS, ShapeItem, Vector } from "../shapez.js";
export class PainterOverride extends MetaPainterBuilding {
    static processPayload(payload) {
        const shapeItem = payload.items.get(0);
        const colorItem = payload.items.get(1);
        function push(v) { payload.outItems.push(v); }
        const paint = (si, color) => this.root.shapeDefinitionMgr.getShapeItemFromDefinition(this.root.shapeDefinitionMgr.shapeActionPaintWith(si.definition, color));
        if (shapeItem instanceof ShapeItem || shapeItem instanceof SzShapeItem) {
            if (colorItem instanceof ColorItem) {
                push({ item: paint(shapeItem, colorItem.color), requiredSlot: 0 });
            }
            else {
                let [color, outColor] = colorItem.splitColor();
                push({ item: paint(shapeItem, color), requiredSlot: 0 });
                if (outColor)
                    push({ item: outColor, requiredSlot: 1, doNotTrack: true });
            }
        }
        else if (shapeItem instanceof SzColorItem) {
            if (colorItem instanceof SzColorItem) {
                let [c1, c2] = shapeItem.fillFromColor(colorItem);
                push({ item: c1, requiredSlot: 0 });
                if (c2)
                    push({ item: c2, requiredSlot: 1, doNotTrack: true });
            }
        }
    }
    static processPayload2(payload) {
        function push(v) { payload.outItems.push(v); }
        const paint = (si, color) => !color ? si :
            this.root.shapeDefinitionMgr.getShapeItemFromDefinition(this.root.shapeDefinitionMgr.shapeActionPaintWith(si.definition, color));
        const shapeItem1 = payload.items.get(0);
        const shapeItem2 = payload.items.get(1);
        const colorItem = payload.items.get(2);
        if (colorItem instanceof ColorItem) {
            push({ item: paint(shapeItem1, colorItem.color) });
            push({ item: shapeItem1 });
            return;
        }
        let [c1, c2] = colorItem.splitIntoColors();
        push({ item: paint(shapeItem1, c1) });
        push({ item: paint(shapeItem2, c2) });
    }
    static install(mod) {
        MOD_ITEM_PROCESSOR_HANDLERS.painter = this.processPayload;
        MOD_ITEM_PROCESSOR_HANDLERS.painterDouble = this.processPayload2;
        mod.modInterface.extendClass(MetaPainterBuilding, ({ $old }) => ({
            updateVariants(entity, rotationVariant, variant) {
                $old.updateVariants.call(this, entity, rotationVariant, variant);
                if (variant == defaultBuildingVariant) {
                    entity.components.ItemEjector.setSlots([
                        { pos: new Vector(1, 0), direction: enumDirection.right },
                        { pos: new Vector(1, 0), direction: enumDirection.bottom },
                    ]);
                    entity.components.ItemAcceptor.setSlots([
                        { pos: new Vector(0, 0), direction: enumDirection.left },
                        { pos: new Vector(1, 0), direction: enumDirection.top, filter: "color" },
                    ]);
                }
                if (variant == enumPainterVariants.mirrored) {
                    entity.components.ItemEjector.setSlots([
                        { pos: new Vector(1, 0), direction: enumDirection.right },
                        { pos: new Vector(1, 0), direction: enumDirection.top },
                    ]);
                    entity.components.ItemAcceptor.setSlots([
                        { pos: new Vector(0, 0), direction: enumDirection.left },
                        { pos: new Vector(1, 0), direction: enumDirection.bottom, filter: "color" },
                    ]);
                }
            },
        }));
        // mod.modInterface.addVariantToExistingBuilding
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFpbnRlck92ZXJyaWRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2J1aWxkaW5ncy9wYWludGVyT3ZlcnJpZGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNqRCxPQUFPLEVBQUUsU0FBUyxFQUFFLHNCQUFzQixFQUFFLGFBQWEsRUFBRSxtQkFBbUIsRUFBdUIsbUJBQW1CLEVBQU8sMkJBQTJCLEVBQWtDLFNBQVMsRUFBRSxNQUFNLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFFcE8sTUFBTSxPQUFPLGVBQWdCLFNBQVEsbUJBQW1CO0lBRXZELE1BQU0sQ0FBQyxjQUFjLENBQTRCLE9BQXVDO1FBQ3ZGLE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBc0QsQ0FBQztRQUM1RixNQUFNLFNBQVMsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQTRCLENBQUM7UUFDbEUsU0FBUyxJQUFJLENBQUMsQ0FBNkIsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDMUUsTUFBTSxLQUFLLEdBQUcsQ0FBQyxFQUEyQixFQUFFLEtBQWEsRUFBRSxFQUFFLENBQzVELElBQUksQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsMEJBQTBCLENBQ3RELElBQUksQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsb0JBQW9CLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBRzNFLElBQUksU0FBUyxZQUFZLFNBQVMsSUFBSSxTQUFTLFlBQVksV0FBVyxFQUFFO1lBQ3ZFLElBQUksU0FBUyxZQUFZLFNBQVMsRUFBRTtnQkFD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RyxFQUFFLElBQUksTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxTQUFTLEVBQUUsYUFBYSxDQUFDLEtBQUssRUFBRTt3QkFDekQsRUFBRSxHQUFHLEVBQUUsSUFBSSxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLFNBQVMsRUFBRSxhQUFhLENBQUMsR0FBRyxFQUFFO3FCQUN2RCxDQUFDLENBQUM7b0JBQ0gsTUFBTSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDO3dCQUN2QyxFQUFFLEdBQUcsRUFBRSxJQUFJLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsU0FBUyxFQUFFLGFBQWEsQ0FBQyxJQUFJLEVBQUU7d0JBQ3hELEVBQUUsR0FBRyxFQUFFLElBQUksTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxTQUFTLEVBQUUsYUFBYSxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFO3FCQUMzRSxDQUFDLENBQUM7aUJBQ0g7WUFDRixDQUFDO1NBQ0QsQ0FBQyxDQUFDLENBQUM7UUFFSixnREFBZ0Q7SUFDakQsQ0FBQztDQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3pDb2xvckl0ZW0gfSBmcm9tIFwiLi4vc2hhcGVzdC9jb2xvci5qc1wiO1xyXG5pbXBvcnQgeyBTelNoYXBlSXRlbSB9IGZyb20gXCIuLi9zaGFwZXN0L2l0ZW0uanNcIjtcclxuaW1wb3J0IHsgQ29sb3JJdGVtLCBkZWZhdWx0QnVpbGRpbmdWYXJpYW50LCBlbnVtRGlyZWN0aW9uLCBlbnVtUGFpbnRlclZhcmlhbnRzLCBJdGVtUHJvY2Vzc29yU3lzdGVtLCBNZXRhUGFpbnRlckJ1aWxkaW5nLCBNb2QsIE1PRF9JVEVNX1BST0NFU1NPUl9IQU5ETEVSUywgUHJvY2Vzc29ySW1wbGVtZW50YXRpb25QYXlsb2FkLCBTaGFwZUl0ZW0sIFZlY3RvciB9IGZyb20gXCIuLi9zaGFwZXouanNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBQYWludGVyT3ZlcnJpZGUgZXh0ZW5kcyBNZXRhUGFpbnRlckJ1aWxkaW5nIHtcclxuXHJcblx0c3RhdGljIHByb2Nlc3NQYXlsb2FkKHRoaXM6IEl0ZW1Qcm9jZXNzb3JTeXN0ZW0sIHBheWxvYWQ6IFByb2Nlc3NvckltcGxlbWVudGF0aW9uUGF5bG9hZCkge1xyXG5cdFx0Y29uc3Qgc2hhcGVJdGVtID0gcGF5bG9hZC5pdGVtcy5nZXQoMCkgYXMgU2hhcGVJdGVtIHwgU3pTaGFwZUl0ZW0gfCBDb2xvckl0ZW0gfCBTekNvbG9ySXRlbTtcclxuXHRcdGNvbnN0IGNvbG9ySXRlbSA9IHBheWxvYWQuaXRlbXMuZ2V0KDEpIGFzIENvbG9ySXRlbSB8IFN6Q29sb3JJdGVtO1xyXG5cdFx0ZnVuY3Rpb24gcHVzaCh2OiB0eXBlb2YgcGF5bG9hZC5vdXRJdGVtc1swXSkgeyBwYXlsb2FkLm91dEl0ZW1zLnB1c2godik7IH1cclxuXHRcdGNvbnN0IHBhaW50ID0gKHNpOiBTaGFwZUl0ZW0gfCBTelNoYXBlSXRlbSwgY29sb3I6IHN0cmluZykgPT5cclxuXHRcdFx0dGhpcy5yb290LnNoYXBlRGVmaW5pdGlvbk1nci5nZXRTaGFwZUl0ZW1Gcm9tRGVmaW5pdGlvbihcclxuXHRcdFx0XHR0aGlzLnJvb3Quc2hhcGVEZWZpbml0aW9uTWdyLnNoYXBlQWN0aW9uUGFpbnRXaXRoKHNpLmRlZmluaXRpb24sIGNvbG9yKSk7XHJcblxyXG5cclxuXHRcdGlmIChzaGFwZUl0ZW0gaW5zdGFuY2VvZiBTaGFwZUl0ZW0gfHwgc2hhcGVJdGVtIGluc3RhbmNlb2YgU3pTaGFwZUl0ZW0pIHtcclxuXHRcdFx0aWYgKGNvbG9ySXRlbSBpbnN0YW5jZW9mIENvbG9ySXRlbSkge1xyXG5cdFx0XHRcdHB1c2goeyBpdGVtOiBwYWludChzaGFwZUl0ZW0sIGNvbG9ySXRlbS5jb2xvciksIHJlcXVpcmVkU2xvdDogMCB9KTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRsZXQgW2NvbG9yLCBvdXRDb2xvcl0gPSBjb2xvckl0ZW0uc3BsaXRDb2xvcigpO1xyXG5cdFx0XHRcdHB1c2goeyBpdGVtOiBwYWludChzaGFwZUl0ZW0sIGNvbG9yKSwgcmVxdWlyZWRTbG90OiAwIH0pO1xyXG5cdFx0XHRcdGlmIChvdXRDb2xvcilcclxuXHRcdFx0XHRcdHB1c2goeyBpdGVtOiBvdXRDb2xvciwgcmVxdWlyZWRTbG90OiAxLCBkb05vdFRyYWNrOiB0cnVlIH0pO1xyXG5cdFx0XHR9XHJcblx0XHR9IGVsc2UgaWYgKHNoYXBlSXRlbSBpbnN0YW5jZW9mIFN6Q29sb3JJdGVtKSB7XHJcblx0XHRcdGlmIChjb2xvckl0ZW0gaW5zdGFuY2VvZiBTekNvbG9ySXRlbSkge1xyXG5cdFx0XHRcdGxldCBbYzEsIGMyXSA9IHNoYXBlSXRlbS5maWxsRnJvbUNvbG9yKGNvbG9ySXRlbSk7XHJcblx0XHRcdFx0cHVzaCh7IGl0ZW06IGMxLCByZXF1aXJlZFNsb3Q6IDAgfSk7XHJcblx0XHRcdFx0aWYgKGMyKSBwdXNoKHsgaXRlbTogYzIsIHJlcXVpcmVkU2xvdDogMSwgZG9Ob3RUcmFjazogdHJ1ZSB9KTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0c3RhdGljIHByb2Nlc3NQYXlsb2FkMih0aGlzOiBJdGVtUHJvY2Vzc29yU3lzdGVtLCBwYXlsb2FkOiBQcm9jZXNzb3JJbXBsZW1lbnRhdGlvblBheWxvYWQpIHtcclxuXHRcdGZ1bmN0aW9uIHB1c2godjogdHlwZW9mIHBheWxvYWQub3V0SXRlbXNbMF0pIHsgcGF5bG9hZC5vdXRJdGVtcy5wdXNoKHYpOyB9XHJcblx0XHRjb25zdCBwYWludCA9IChzaTogU2hhcGVJdGVtIHwgU3pTaGFwZUl0ZW0sIGNvbG9yOiBzdHJpbmcgfCBudWxsKSA9PlxyXG5cdFx0XHQhY29sb3IgPyBzaSA6XHJcblx0XHRcdFx0dGhpcy5yb290LnNoYXBlRGVmaW5pdGlvbk1nci5nZXRTaGFwZUl0ZW1Gcm9tRGVmaW5pdGlvbihcclxuXHRcdFx0XHRcdHRoaXMucm9vdC5zaGFwZURlZmluaXRpb25NZ3Iuc2hhcGVBY3Rpb25QYWludFdpdGgoc2kuZGVmaW5pdGlvbiwgY29sb3IpKTtcclxuXHJcblx0XHRjb25zdCBzaGFwZUl0ZW0xID0gcGF5bG9hZC5pdGVtcy5nZXQoMCkgYXMgU2hhcGVJdGVtIHwgU3pTaGFwZUl0ZW07XHJcblx0XHRjb25zdCBzaGFwZUl0ZW0yID0gcGF5bG9hZC5pdGVtcy5nZXQoMSkgYXMgU2hhcGVJdGVtIHwgU3pTaGFwZUl0ZW07XHJcblx0XHRjb25zdCBjb2xvckl0ZW0gPSBwYXlsb2FkLml0ZW1zLmdldCgyKSBhcyBDb2xvckl0ZW0gfCBTekNvbG9ySXRlbTtcclxuXHJcblx0XHRpZiAoY29sb3JJdGVtIGluc3RhbmNlb2YgQ29sb3JJdGVtKSB7XHJcblx0XHRcdHB1c2goeyBpdGVtOiBwYWludChzaGFwZUl0ZW0xLCBjb2xvckl0ZW0uY29sb3IpIH0pO1xyXG5cdFx0XHRwdXNoKHsgaXRlbTogc2hhcGVJdGVtMSB9KTtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0bGV0IFtjMSwgYzJdID0gY29sb3JJdGVtLnNwbGl0SW50b0NvbG9ycygpO1xyXG5cdFx0cHVzaCh7IGl0ZW06IHBhaW50KHNoYXBlSXRlbTEsIGMxKSB9KTtcclxuXHRcdHB1c2goeyBpdGVtOiBwYWludChzaGFwZUl0ZW0yLCBjMikgfSk7XHJcblx0fVxyXG5cclxuXHJcblx0c3RhdGljIGluc3RhbGwobW9kOiBNb2QpIHtcclxuXHJcblx0XHRNT0RfSVRFTV9QUk9DRVNTT1JfSEFORExFUlMucGFpbnRlciA9IHRoaXMucHJvY2Vzc1BheWxvYWQ7XHJcblx0XHRNT0RfSVRFTV9QUk9DRVNTT1JfSEFORExFUlMucGFpbnRlckRvdWJsZSA9IHRoaXMucHJvY2Vzc1BheWxvYWQyO1xyXG5cclxuXHJcblx0XHRtb2QubW9kSW50ZXJmYWNlLmV4dGVuZENsYXNzKE1ldGFQYWludGVyQnVpbGRpbmcsICh7ICRvbGQgfSkgPT4gKHtcclxuXHRcdFx0dXBkYXRlVmFyaWFudHMoZW50aXR5OiB7IGNvbXBvbmVudHM6IHsgSXRlbUVqZWN0b3I6IHsgc2V0U2xvdHM6IChhcmcwOiB7IHBvczogVmVjdG9yOyBkaXJlY3Rpb246IHN0cmluZzsgfVtdKSA9PiB2b2lkOyB9OyBJdGVtQWNjZXB0b3I6IHsgc2V0U2xvdHM6IChhcmcwOiAoeyBwb3M6IFZlY3RvcjsgZGlyZWN0aW9uOiBzdHJpbmc7IGZpbHRlcj86IHVuZGVmaW5lZDsgfSB8IHsgcG9zOiBWZWN0b3I7IGRpcmVjdGlvbjogc3RyaW5nOyBmaWx0ZXI6IHN0cmluZzsgfSlbXSkgPT4gdm9pZDsgfTsgfTsgfSwgcm90YXRpb25WYXJpYW50OiBhbnksIHZhcmlhbnQ6IHN0cmluZykge1xyXG5cdFx0XHRcdCRvbGQudXBkYXRlVmFyaWFudHMuY2FsbCh0aGlzLCBlbnRpdHksIHJvdGF0aW9uVmFyaWFudCwgdmFyaWFudCk7XHJcblx0XHRcdFx0aWYgKHZhcmlhbnQgPT0gZGVmYXVsdEJ1aWxkaW5nVmFyaWFudCkge1xyXG5cdFx0XHRcdFx0ZW50aXR5LmNvbXBvbmVudHMuSXRlbUVqZWN0b3Iuc2V0U2xvdHMoW1xyXG5cdFx0XHRcdFx0XHR7IHBvczogbmV3IFZlY3RvcigxLCAwKSwgZGlyZWN0aW9uOiBlbnVtRGlyZWN0aW9uLnJpZ2h0IH0sXHJcblx0XHRcdFx0XHRcdHsgcG9zOiBuZXcgVmVjdG9yKDEsIDApLCBkaXJlY3Rpb246IGVudW1EaXJlY3Rpb24uYm90dG9tIH0sXHJcblx0XHRcdFx0XHRdKTtcclxuXHRcdFx0XHRcdGVudGl0eS5jb21wb25lbnRzLkl0ZW1BY2NlcHRvci5zZXRTbG90cyhbXHJcblx0XHRcdFx0XHRcdHsgcG9zOiBuZXcgVmVjdG9yKDAsIDApLCBkaXJlY3Rpb246IGVudW1EaXJlY3Rpb24ubGVmdCB9LFxyXG5cdFx0XHRcdFx0XHR7IHBvczogbmV3IFZlY3RvcigxLCAwKSwgZGlyZWN0aW9uOiBlbnVtRGlyZWN0aW9uLnRvcCwgZmlsdGVyOiBcImNvbG9yXCIgfSxcclxuXHRcdFx0XHRcdF0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAodmFyaWFudCA9PSBlbnVtUGFpbnRlclZhcmlhbnRzLm1pcnJvcmVkKSB7XHJcblx0XHRcdFx0XHRlbnRpdHkuY29tcG9uZW50cy5JdGVtRWplY3Rvci5zZXRTbG90cyhbXHJcblx0XHRcdFx0XHRcdHsgcG9zOiBuZXcgVmVjdG9yKDEsIDApLCBkaXJlY3Rpb246IGVudW1EaXJlY3Rpb24ucmlnaHQgfSxcclxuXHRcdFx0XHRcdFx0eyBwb3M6IG5ldyBWZWN0b3IoMSwgMCksIGRpcmVjdGlvbjogZW51bURpcmVjdGlvbi50b3AgfSxcclxuXHRcdFx0XHRcdF0pO1xyXG5cdFx0XHRcdFx0ZW50aXR5LmNvbXBvbmVudHMuSXRlbUFjY2VwdG9yLnNldFNsb3RzKFtcclxuXHRcdFx0XHRcdFx0eyBwb3M6IG5ldyBWZWN0b3IoMCwgMCksIGRpcmVjdGlvbjogZW51bURpcmVjdGlvbi5sZWZ0IH0sXHJcblx0XHRcdFx0XHRcdHsgcG9zOiBuZXcgVmVjdG9yKDEsIDApLCBkaXJlY3Rpb246IGVudW1EaXJlY3Rpb24uYm90dG9tLCBmaWx0ZXI6IFwiY29sb3JcIiB9LFxyXG5cdFx0XHRcdFx0XSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9LFxyXG5cdFx0fSkpO1xyXG5cclxuXHRcdC8vIG1vZC5tb2RJbnRlcmZhY2UuYWRkVmFyaWFudFRvRXhpc3RpbmdCdWlsZGluZ1xyXG5cdH1cclxufSJdfQ==