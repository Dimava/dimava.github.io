var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
import { SzLayer, SzLayerQuad, SzInfo, SzLayerArea } from './shapest/layer.js';
import { SzContext2D } from './shapest/SzContext2D.js';
let layer = // new SzLayer();
 SzLayer.fromShortKey('l!z|q!C-06C-6cC-ciC-io|a!su06su6csucisuio|c!');
// SzInfo.quad.exampleLayer('circle');
// new SzLayer();
// new SzLayer(testTemplate);
let savedShapes = JSON.parse(localStorage.getItem('szSavedShapes') ?? '["sz!l!z|q!C-06C-6cC-ciC-io|a!su06su6csucisuio|c!"]');
let rawData = {
    layer, layers: [layer], savedShapes
};
let data = Vue.reactive({ source: rawData });
Object.assign(globalThis, { layer, data, rawData });
// let layer = SzLayer.createTest();
// layer.drawCenteredNormalized(sctx);
function registerQuad(name, code, path) {
    let quad = { name: name, code, path };
    SzInfo.quad.list.push(quad);
    SzInfo.quad.byName[quad.name] = quad;
    SzInfo.quad.byChar[quad.code] = quad;
    SzInfo.quad.quadList.push(quad.name);
}
registerQuad('test', 'X', (ctx, { from, to }) => {
    ctx.lineToR(0.8, from);
    ctx.lineToR(Math.SQRT2, (from + to) / 2);
    ctx.lineToR(0.4, to);
});
let LayerCanvasVue = class LayerCanvasVue extends VueImpl.with(makeClass({
    hash: [String],
    layer: [SzLayer],
    layers: [Array],
    size: Number,
})) {
    get _t() {
        return `
			<canvas ref="cv"
				:width="size" :height="size"
				style="border: 1px solid black;"
				:style="{width: size + 'px', height: size + 'px'}"
				@click=redraw() />
		`;
    }
    v_ctx = null;
    get ctx() {
        if (this.v_ctx)
            return this.v_ctx;
        if (!this.$refs.cv)
            return null;
        return this.v_ctx = SzContext2D.fromCanvas(this.$refs.cv);
    }
    mounted() {
        this.redraw();
    }
    redraw() {
        if (!this.ctx)
            return;
        this.ctx.clear();
        if (this.layer) {
            this.layer.drawCenteredNormalized(this.ctx);
        }
        if (this.layers) {
            this.layers.map((e, i) => {
                e.drawCenteredLayerScaled(this.ctx, i);
            });
        }
        if (this.hash) {
            let layers = this.hash.startsWith('sz!') ? this.hash.slice(3).split(':').map(SzLayer.fromShortKey)
                : this.hash.split(':').map(SzLayer.fromShapezHash);
            layers.map((e, i) => {
                e.drawCenteredLayerScaled(this.ctx, i);
            });
        }
    }
};
__decorate([
    Template
], LayerCanvasVue.prototype, "_t", null);
LayerCanvasVue = __decorate([
    GlobalComponent({
        watch: {
            layers: {
                handler: function (val) {
                    this.redraw();
                },
                deep: true,
            }
        }
    })
], LayerCanvasVue);
let QuadEditorVue = class QuadEditorVue extends VueImpl.with(makeClass({
    quad: [SzLayerQuad],
    area: [SzLayerArea],
    parent: SzLayer,
})) {
    get _t() {
        let c = this.allColors[0];
        let q = this.allQuads[0];
        return `
			<a-row>
				<LayerCanvasVue :size="64" :layer="layer" :key="layer.getHash()"
					@contextmenu.prevent="${this.remove()}" />
				&emsp;
				<div style="line-height:0" >
					<LayerCanvasVue :size="32" v-if="quad"
						v-for="${q} of ${this.allQuads}"
						:title="${q}"
						:layer="${this.quadLayer(q)}"
						:class="${this.quad.shape == q ? 'selected' : 'unselected'}"
						@click="${this.quad.shape = q}" />
					<br>
					<LayerCanvasVue :size="32" v-if="area"
						v-for="${c} of ${this.allColors}"
						:title="${c}"
						:layer="${this.colorLayer(c)}"
						:class="${this.area.color == c ? 'selected' : 'unselected'}"
						@click="${this.area.color = c}" />
					<br>
					<a-slider
						range :min="0" :max="30" :step="2"
						 :marks="${{ 0: '', 6: '', 12: '', 18: '', 24: '', 30: '' }}"
						v-model:value="fromTo"
						style="width: 300px" />
				</div>
			</a-row>
		`;
    }
    rnd = 0;
    get layer() {
        this.rnd;
        if (this.quad) {
            return new SzLayer({
                quads: [this.quad],
                areas: [new SzLayerArea({ from: 0, to: 24, color: 'grey', shape: 'sector' })],
            });
        }
        if (this.area) {
            return new SzLayer({
                quads: [new SzLayerQuad({ to: 24 })],
                areas: [this.area],
            });
        }
        return SzInfo.color.exampleLayer('grey');
    }
    get allColors() {
        return SzInfo.color.colorList;
    }
    get allQuads() {
        console.log(SzInfo.quad.quadList);
        return SzInfo.quad.quadList;
    }
    colorLayer(color) {
        return SzInfo.color.exampleLayer(color);
    }
    quadLayer(shape) {
        return SzInfo.quad.exampleLayer(shape);
    }
    get fromTo() {
        let e = this.quad || this.area;
        return [e.from, e.to];
    }
    set fromTo([from, to]) {
        let e = this.quad || this.area;
        if (e.to == to) {
            e.to += from - e.from;
            e.from = from;
        }
        else {
            e.to = to;
        }
    }
    remove() {
        this.quad && this.parent.quads.splice(this.parent.quads.indexOf(this.quad), 1);
        this.area && this.parent.areas.splice(this.parent.areas.indexOf(this.area), 1);
    }
};
__decorate([
    Template
], QuadEditorVue.prototype, "_t", null);
QuadEditorVue = __decorate([
    GlobalComponent
], QuadEditorVue);
class LayerVue extends VueImpl.with(makeClass({
    source: null,
})) {
    get _t() {
        return `
			<APP>
				<h1> Shapest viewer </h1>
				<a-row>
					<a-col>
						<LayerCanvasVue :size="256" :layers="layers" />
						<template v-for="(l, i) of layers" :key="i + hash.split(':')[i]">
							<br v-if="i % 2 == 0">
							<LayerCanvasVue :size="128" :layer="l"								
								:class="l == selectedLayer ? 'selected' : 'unselected'"
								@click="selectedLayerIndex = i"
								/>
						</template>
						<br>
						<button @click="${this.popLayer}"> - </button>
						<button @click="${this.pushLayer}"> + </button>
						<button @click="hash = hash" :class="[!isNormalized && 'selected']"> â†º </button>
						<br>
						<input :value="${this.hash}" @change="hash=$event.target.value" style="width: 100%;font-family: monospace;font-size: small;" />
					</a-col>
					<a-col> <a-col>
						<textarea v-model="customQuad" style="resize:both;width:400px;height:200px"></textarea>
						<QuadEditorVue
							v-for="(quad, i) of selectedLayer?.quads" :key="i"
							:quad="quad" :parent="selectedLayer" />
						<button @click="${this.popQuad}"> - </button>
						<button @click="${this.pushQuad}"> + </button>
					</a-col> <a-col>
						<QuadEditorVue
							v-for="(area, i) of selectedLayer?.areas" :key="i"
							:area="area" :parent="selectedLayer" />
						<button @click="${this.popArea}"> - </button>
						<button @click="${this.pushArea}"> + </button>
					</a-col> </a-col>
				</a-row>
				<a-row>
					<button @click="this.saveShape()"> Save current shape </button>
					<LayerCanvasVue :size="64"
						v-for="hash of ${this.source.savedShapes}"
						:hash="hash" :key="hash"
						@click="this.hash = hash"
						@contextmenu.prevent="unsaveShape(hash)" />
				</a-row>
				<a-row>
					<LayerCanvasVue :size="64"
						v-for="(hash, name) in ${this.named}"
						:title="name"
						:hash="hash" :key="hash"
						@click="this.hash = hash"
						@contextmenu.prevent="unsaveShape(hash)" />
				</a-row>
			</APP>
		`;
    }
    ;
    get layers() {
        return this.source.layers;
    }
    selectedLayerIndex = 0;
    get selectedLayer() {
        return this.layers[this.selectedLayerIndex];
    }
    mounted() {
        Object.assign(globalThis, { view: this });
    }
    ctx = null;
    setFromTo(quad, v) {
        quad.from = v[0];
        quad.to = v[1];
    }
    popQuad() {
        this.selectedLayer.quads.pop();
    }
    pushQuad() {
        let from = this.selectedLayer.quads.slice(-1)[0]?.to ?? 0;
        this.selectedLayer.quads.push(new SzLayerQuad({ from, to: from + 6 }));
    }
    popArea() {
        this.selectedLayer.areas.pop();
    }
    pushArea() {
        let from = this.selectedLayer.areas.slice(-1)[0]?.to ?? 0;
        this.selectedLayer.areas.push(new SzLayerArea({ from, to: from + 6 }));
    }
    popLayer() { this.layers.pop(); }
    pushLayer() {
        this.layers.push(SzLayer.fromShortKey('l!z|q!C-06,C-6c,C-ci,C-io|a!su0o|c!'));
    }
    get named() {
        return [
            SzInfo.quad.named,
            SzInfo.quad.named4,
            SzInfo.quad.named6,
        ].flatMap(e => Object.values(e));
    }
    get hash() {
        return this.layers.map(e => e.clone().getHash()).join(':');
    }
    set hash(v) {
        this.source.layers =
            v.startsWith('sz!') ? v.slice(3).split(':').map(SzLayer.fromShortKey)
                : v.split(':').map(SzLayer.fromShapezHash);
    }
    saveShape() {
        this.unsaveShape(this.hash);
        this.source.savedShapes.push(this.hash);
        localStorage.setItem('szSavedShapes', JSON.stringify(this.source.savedShapes));
    }
    unsaveShape(hash) {
        if (this.source.savedShapes.includes(hash)) {
            this.source.savedShapes.splice(this.source.savedShapes.indexOf(hash), 1);
            localStorage.setItem('szSavedShapes', JSON.stringify(this.source.savedShapes));
        }
    }
    get isNormalized() {
        return this.layers.every(e => e.isNormalized());
    }
    path = `
ctx.lineToR(0.8, from);
ctx.lineToR(Math.SQRT2, (from + to) / 2);
ctx.lineToR(0.4, to);
	`.trim();
    get customQuad() {
        return this.path;
    }
    set customQuad(v) {
        console.log(v);
        try {
            let s = `
				function f() {
					return (ctx, { from, to }) => {
						${v}
					}
				}
				f
			`;
            let path = eval(s)();
            let X = SzInfo.quad.byChar.X;
            console.log({ path });
            X.path = path;
        }
        catch (e) {
            console.error(e);
        }
        ;
        this.hash = this.hash;
        this.path = v;
    }
}
__decorate([
    Template
], LayerVue.prototype, "_t", null);
createApp(LayerVue, data).use(antd).mount('body');
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlld2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3ZpZXdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFHQSxPQUFPLEVBQUUsT0FBTyxFQUFZLFdBQVcsRUFBRSxNQUFNLEVBQW9CLFdBQVcsRUFBRSxNQUFNLG9CQUFvQixDQUFBO0FBQzFHLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUd2RCxJQUFJLEtBQUssR0FBRSxpQkFBaUI7Q0FDM0IsT0FBTyxDQUFDLFlBQVksQ0FBQyw4Q0FBOEMsQ0FBQyxDQUFBO0FBQ3JFLHNDQUFzQztBQUN0QyxpQkFBaUI7QUFDakIsNkJBQTZCO0FBRTdCLElBQUksV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsSUFBSSxxREFBcUQsQ0FBQyxDQUFBO0FBRTVILElBQUksT0FBTyxHQUFHO0lBQ2IsS0FBSyxFQUFFLE1BQU0sRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLFdBQVc7Q0FDbkMsQ0FBQTtBQUNELElBQUksSUFBSSxHQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztBQUM3QyxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztBQUNwRCxvQ0FBb0M7QUFFcEMsc0NBQXNDO0FBRXRDLFNBQVMsWUFBWSxDQUNwQixJQUFZLEVBQUUsSUFBWSxFQUFFLElBQW1EO0lBRS9FLElBQUksSUFBSSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQWlCLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFBO0lBQ2xELE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM1QixNQUFNLENBQUMsSUFBSSxDQUFD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SUFBSSxFQUFDLENBQUMsQ0FBQztZQUNwQixDQUFDLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztTQUNkO1FBQUMsT0FBTSxDQUFDLEVBQUM7WUFDVCxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFBO1NBQ2hCO1FBQUEsQ0FBQztRQUNGLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUN0QixJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQztJQUNmLENBQUM7Q0FDRDtBQTFKQTtJQURDLFFBQVE7a0NBdURSO0FBc0dGLFNBQVMsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG5cclxuaW1wb3J0IHsgUHJvcE9wdGlvbnNXaXRoIH0gZnJvbSAnQGRpbWF2YS92dWUtcHJvcC1kZWNvcmF0b3ItYS12YXJpYXRpb24nO1xyXG5pbXBvcnQgeyBTekxheWVyLCBJU3pMYXllciwgU3pMYXllclF1YWQsIFN6SW5mbywgY29sb3IsIHF1YWRTaGFwZSwgU3pMYXllckFyZWEgfSBmcm9tICcuL3NoYXBlc3QvbGF5ZXIuanMnXHJcbmltcG9ydCB7IFN6Q29udGV4dDJEIH0gZnJvbSAnLi9zaGFwZXN0L1N6Q29udGV4dDJELmpzJztcclxuXHJcblxyXG5sZXQgbGF5ZXIgPS8vIG5ldyBTekxheWVyKCk7XHJcblx0U3pMYXllci5mcm9tU2hvcnRLZXkoJ2whenxxIUMtMDZDLTZjQy1jaUMtaW98YSFzdTA2c3U2Y3N1Y2lzdWlvfGMhJylcclxuLy8gU3pJbmZvLnF1YWQuZXhhbXBsZUxheWVyKCdjaXJjbGUnKTtcclxuLy8gbmV3IFN6TGF5ZXIoKTtcclxuLy8gbmV3IFN6TGF5ZXIodGVzdFRlbXBsYXRlKTtcclxuXHJcbmxldCBzYXZlZFNoYXBlcyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3N6U2F2ZWRTaGFwZXMnKSA/PyAnW1wic3ohbCF6fHEhQy0wNkMtNmNDLWNpQy1pb3xhIXN1MDZzdTZjc3VjaXN1aW98YyFcIl0nKVxyXG5cclxubGV0IHJhd0RhdGEgPSB7XHJcblx0bGF5ZXIsIGxheWVyczogW2xheWVyXSwgc2F2ZWRTaGFwZXNcclxufVxyXG5sZXQgZGF0YSA9IFZ1ZS5yZWFjdGl2ZSh7IHNvdXJjZTogcmF3RGF0YSB9KTtcclxuT2JqZWN0LmFzc2lnbihnbG9iYWxUaGlzLCB7IGxheWVyLCBkYXRhLCByYXdEYXRhIH0pO1xyXG4vLyBsZXQgbGF5ZXIgPSBTekxheWVyLmNyZWF0ZVRlc3QoKTtcclxuXHJcbi8vIGxheWVyLmRyYXdDZW50ZXJlZE5vcm1hbGl6ZWQoc2N0eCk7XHJcblxyXG5mdW5jdGlvbiByZWdpc3RlclF1YWQoXHJcblx0bmFtZTogc3RyaW5nLCBjb2RlOiBzdHJpbmcsIHBhdGg6IChjdHg6IFN6Q29udGV4dDJELCBxdWFkOiBTekxheWVyUXVhZCkgPT4gdm9pZFxyXG4pIHtcclxuXHRsZXQgcXVhZCA9IHsgbmFtZTogbmFtZSBhcyBxdWFkU2hhcGUsIGNvZGUsIHBhdGggfVxyXG5cdFN6SW5mby5xdWFkLmxpc3QucHVzaChxdWFkKTtcclxuXHRTekluZm8ucXVhZC5ieU5hbWVbcXVhZC5uYW1lXSA9IHF1YWQ7XHJcblx0U3pJbmZvLnF1YWQuYnlDaGFyW3F1YWQuY29kZV0gPSBxdWFkO1xyXG5cdFN6SW5mby5xdWFkLnF1YWRMaXN0LnB1c2gocXVhZC5uYW1lKTtcclxufVxyXG5cclxucmVnaXN0ZXJRdWFkKCd0ZXN0JywgJ1gnLCAoY3R4LCB7IGZyb20sIHRvIH0pID0+IHtcclxuXHRjdHgubGluZVRvUigwLjgsIGZyb20pO1xyXG5cdGN0eC5saW5lVG9SKE1hdGguU1FSVDIsIChmcm9tICsgdG8pIC8gMik7XHJcblx0Y3R4LmxpbmVUb1IoMC40LCB0byk7XHJcbn0pO1xyXG5cclxuXHJcblxyXG5AR2xvYmFsQ29tcG9uZW50KHtcclxuXHR3YXRjaDoge1xyXG5cdFx0bGF5ZXJzOiB7XHJcblx0XHRcdGhhbmRsZXI6IGZ1bmN0aW9uICh2YWwpIHtcclxuXHRcdFx0XHR0aGlzLnJlZHJhdygpO1xyXG5cdFx0XHR9LFxyXG5cdFx0XHRkZWVwOiB0cnVlLFxyXG5cdFx0fVxyXG5cdH1cclxufSlcclxuY2xhc3MgTGF5ZXJDYW52YXNWdWUgZXh0ZW5kcyBWdWVJbXBsLndpdGgobWFrZUNsYXNzKHtcclxuXHRoYXNoOiBbU3RyaW5nXSxcclxuXHRsYXllcjogW1N6TGF5ZXJdLFxyXG5cdGxheWVyczogW0FycmF5XSBhcyBhbnkgYXMgUHJvcE9wdGlvbnNXaXRoPFN6TGF5ZXJbXSwgbmV2ZXIsIGZhbHNlPixcclxuXHRzaXplOiBOdW1iZXIsXHJcbn0pKSB7XHJcblx0QFRlbXBsYXRlXHJcblx0Z2V0IF90KCkge1xyXG5cdFx0cmV0dXJuIGBcclxuXHRcdFx0PGNhbnZhcyByZWY9XCJjdlwiXHJcblx0XHRcdFx0OndpZHRoPVwic2l6ZVwiIDpoZWlnaHQ9XCJzaXplXCJcclxuXHRcdFx0XHRzdHlsZT1cImJvcmRlcjogMXB4IHNvbGlkIGJsYWNrO1wiXHJcblx0XHRcdFx0OnN0eWxlPVwie3dpZHRoOiBzaXplICsgJ3B4JywgaGVpZ2h0OiBzaXplICsgJ3B4J31cIlxyXG5cdFx0XHRcdEBjbGljaz1yZWRyYXcoKSAvPlxyXG5cdFx0YDtcclxuXHR9XHJcblx0dl9jdHg6IFN6Q29udGV4dDJEID0gbnVsbCBhcyBhbnk7XHJcblx0Z2V0IGN0eCgpIHtcclxuXHRcdGlmICh0aGlzLnZfY3R4KSByZXR1cm4gdGhpcy52X2N0eDtcclxuXHRcdGlmICghdGhpcy4kcmVmcy5jdikgcmV0dXJuIG51bGw7XHJcblx0XHRyZXR1cm4gdGhpcy52X2N0eCA9IFN6Q29udGV4dDJELmZyb21DYW52YXModGhpcy4kcmVmcy5jdiBhcyBIVE1MQ2FudmFzRWxlbWVudCk7XHJcblx0fVxyXG5cdG1vdW50ZWQoKSB7XHJcblx0XHR0aGlzLnJlZHJhdygpO1xyXG5cdH1cclxuXHRyZWRyYXcoKSB7XHJcblx0XHRpZiAoIXRoaXMuY3R4KSByZXR1cm47XHJcblx0XHR0aGlzLmN0eC5jbGVhcigpO1xyXG5cdFx0aWYgKHRoaXMubGF5ZXIpIHtcclxuXHRcdFx0dGhpcy5sYXllci5kcmF3Q2VudGVyZWROb3JtYWxpemVkKHRoaXMuY3R4KTtcclxuXHRcdH1cclxuXHRcdGlmICh0aGlzLmxheWVycykge1xyXG5cdFx0XHR0aGlzLmxheWVycy5tYXAoKGUsIGkpID0+IHtcclxuXHRcdFx0XHRlLmRyYXdDZW50ZXJlZExheWVyU2NhbGVkKHRoaXMuY3R4ISwgaSk7XHJcblx0XHRcdH0pXHJcblx0XHR9XHJcblx0XHRpZiAodGhpcy5oYXNoKSB7XHJcblx0XHRcdGxldCBsYXllcnMgPVxyXG5cdFx0XHRcdHRoaXMuaGFzaC5zdGFydHNXaXRoKCdzeiEnKSA/IHRoaXMuaGFzaC5zbGljZSgzKS5zcGxpdCgnOicpLm1hcChTekxheWVyLmZyb21TaG9ydEtleSlcclxuXHRcdFx0XHRcdDogdGhpcy5oYXNoLnNwbGl0KCc6JykubWFwKFN6TGF5ZXIuZnJvbVNoYXBlekhhc2gpO1xyXG5cdFx0XHRsYXllcnMubWFwKChlLCBpKSA9PiB7XHJcblx0XHRcdFx0ZS5kcmF3Q2VudGVyZWRMYXllclNjYWxlZCh0aGlzLmN0eCEsIGkpO1xyXG5cdFx0XHR9KVxyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuQEdsb2JhbENvbXBvbmVudFxyXG5jbGFzcyBRdWFkRWRpdG9yVnVlIGV4dGVuZHMgVnVlSW1wbC53aXRoKG1ha2VDbGFzcyh7XHJcblx0cXVhZDogW1N6TGF5ZXJRdWFkXSBhcyBhbnkgYXMgUHJvcE9wdGlvbnNXaXRoPFN6TGF5ZXJRdWFkLCBuZXZlciwgdHJ1ZT4sXHJcblx0YXJlYTogW1N6TGF5ZXJBcmVhXSBhcyBhbnkgYXMgUHJvcE9wdGlvbnNXaXRoPFN6TGF5ZXJBcmVhLCBuZXZlciwgdHJ1ZT4sXHJcblx0cGFyZW50OiBTekxheWVyLFxyXG59KSkge1xyXG5cdEBUZW1wbGF0ZVxyXG5cdGdldCBfdCgpIHtcclxuXHRcdGxldCBjID0gdGhpcy5hbGxDb2xvcnNbMF07XHJcblx0XHRsZXQgcSA9IHRoaXMuYWxsUXVhZHNbMF07XHJcblx0XHRyZXR1cm4gYFxyXG5cdFx0XHQ8YS1yb3c+XHJcblx0XHRcdFx0PExheWVyQ2FudmFzVnVlIDpzaXplPVwiNjRcIiA6bGF5ZXI9XCJsYXllclwiIDprZXk9XCJsYXllci5nZXRIYXNoKClcIlxyXG5cdFx0XHRcdFx0QGNvbnRleHRtZW51LnByZXZlbnQ9XCIke3RoaXMucmVtb3ZlKCl9XCIgLz5cclxuXHRcdFx0XHQmZW1zcDtcclxuXHRcdFx0XHQ8ZGl2IHN0eWxlPVwibGluZS1oZWlnaHQ6MFwiID5cclxuXHRcdFx0XHRcdDxMYXllckNhbnZhc1Z1ZSA6c2l6ZT1cIjMyXCIgdi1pZj1cInF1YWRcIlxyXG5cdFx0XHRcdFx0XHR2LWZvcj1cIiR7cX0gb2YgJHt0aGlzLmFsbFF1YWRzfVwiXHJcblx0XHRcdFx0XHRcdDp0aXRsZT1cIiR7cX1cIlxyXG5cdFx0XHRcdFx0XHQ6bGF5ZXI9XCIke3RoaXMucXVhZExheWVyKHEpfVwiXHJcblx0XHRcdFx0XHRcdDpjbGFzcz1cIiR7dGhpcy5xdWFkLnNoYXBlID09IHEgPyAnc2VsZWN0ZWQnIDogJ3Vuc2VsZWN0ZWQnfVwiXHJcblx0XHRcdFx0XHRcdEBjbGljaz1cIiR7dGhpcy5xdWFkLnNoYXBlID0gcX1cIiAvPlxyXG5cdFx0XHRcdFx0PGJyPlxyXG5cdFx0XHRcdFx0PExheWVyQ2FudmFzVnVlIDpzaXplPVwiMzJcIiB2LWlmPVwiYXJlYVwiXHJcblx0XHRcdFx0XHRcdHYtZm9yPVwiJHtjfSBvZiAke3RoaXMuYWxsQ29sb3JzfVwiXHJcblx0XHRcdFx0XHRcdDp0aXRsZT1cIiR7Y31cIlxyXG5cdFx0XHRcdFx0XHQ6bGF5ZXI9XCIke3RoaXMuY29sb3JMYXllcihjKX1cIlxyXG5cdFx0XHRcdFx0XHQ6Y2xhc3M9XCIke3RoaXMuYXJlYS5jb2xvciA9PSBjID8gJ3NlbGVjdGVkJyA6ICd1bnNlbGVjdGVkJ31cIlxyXG5cdFx0XHRcdFx0XHRAY2xpY2s9XCIke3RoaXMuYXJlYS5jb2xvciA9IGN9XCIgLz5cclxuXHRcdFx0XHRcdDxicj5cclxuXHRcdFx0XHRcdDxhLXNsaWRlclxyXG5cdFx0XHRcdFx0XHRyYW5nZSA6bWluPVwiMFwiIDptYXg9XCIzMFwiIDpzdGVwPVwiMlwiXHJcblx0XHRcdFx0XHRcdCA6bWFya3M9XCIke3sgMDogJycsIDY6ICcnLCAxMjogJycsIDE4OiAnJywgMjQ6ICcnLCAzMDogJycgfX1cIlxyXG5cdFx0XHRcdFx0XHR2LW1vZGVsOnZhbHVlPVwiZnJvbVRvXCJcclxuXHRcdFx0XHRcdFx0c3R5bGU9XCJ3aWR0aDogMzAwcHhcIiAvPlxyXG5cdFx0XHRcdDwvZGl2PlxyXG5cdFx0XHQ8L2Etcm93PlxyXG5cdFx0YDtcclxuXHR9XHJcblx0cm5kID0gMDtcclxuXHRnZXQgbGF5ZXIoKSB7XHJcblx0XHR0aGlzLnJuZDtcclxuXHRcdGlmICh0aGlzLnF1YWQpIHtcclxuXHRcdFx0cmV0dXJuIG5ldyBTekxheWVyKHtcclxuXHRcdFx0XHRxdWFkczogW3RoaXMucXVhZF0sXHJcblx0XHRcdFx0YXJlYXM6IFtuZXcgU3pMYXllckFyZWEoeyBmcm9tOiAwLCB0bzogMjQsIGNvbG9yOiAnZ3JleScsIHNoYXBlOiAnc2VjdG9yJyB9KV0sXHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHRoaXMuYXJlYSkge1xyXG5cdFx0XHRyZXR1cm4gbmV3IFN6TGF5ZXIoe1xyXG5cdFx0XHRcdHF1YWRzOiBbbmV3IFN6TGF5ZXJRdWFkKHsgdG86IDI0IH0pXSxcclxuXHRcdFx0XHRhcmVhczogW3RoaXMuYXJlYV0sXHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIFN6SW5mby5jb2xvci5leGFtcGxlTGF5ZXIoJ2dyZXknKTtcclxuXHR9XHJcblx0Z2V0IGFsbENvbG9ycygpIHtcclxuXHRcdHJldHVybiBTekluZm8uY29sb3IuY29sb3JMaXN0O1xyXG5cdH1cclxuXHRnZXQgYWxsUXVhZHMoKSB7XHJcblx0XHRjb25zb2xlLmxvZyhTekluZm8ucXVhZC5xdWFkTGlzdCk7XHJcblx0XHRyZXR1cm4gU3pJbmZvLnF1YWQucXVhZExpc3Q7XHJcblx0fVxyXG5cdGNvbG9yTGF5ZXIoY29sb3I6IGNvbG9yKSB7XHJcblx0XHRyZXR1cm4gU3pJbmZvLmNvbG9yLmV4YW1wbGVMYXllcihjb2xvcik7XHJcblx0fVxyXG5cdHF1YWRMYXllcihzaGFwZTogcXVhZFNoYXBlKSB7XHJcblx0XHRyZXR1cm4gU3pJbmZvLnF1YWQuZXhhbXBsZUxheWVyKHNoYXBlKTtcclxuXHR9XHJcblx0Z2V0IGZyb21UbygpOiBbbnVtYmVyLCBudW1iZXJdIHtcclxuXHRcdGxldCBlID0gdGhpcy5xdWFkIHx8IHRoaXMuYXJlYTtcclxuXHRcdHJldHVybiBbZS5mcm9tLCBlLnRvXTtcclxuXHR9XHJcblx0c2V0IGZyb21UbyhbZnJvbSwgdG9dOiBbbnVtYmVyLCBudW1iZXJdKSB7XHJcblx0XHRsZXQgZSA9IHRoaXMucXVhZCB8fCB0aGlzLmFyZWE7XHJcblx0XHRpZiAoZS50byA9PSB0bykge1xyXG5cdFx0XHRlLnRvICs9IGZyb20gLSBlLmZyb207XHJcblx0XHRcdGUuZnJvbSA9IGZyb207XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRlLnRvID0gdG87XHJcblx0XHR9XHJcblx0fVxyXG5cdHJlbW92ZSgpIHtcclxuXHRcdHRoaXMucXVhZCAmJiB0aGlzLnBhcmVudC5xdWFkcy5zcGxpY2UodGhpcy5wYXJlbnQucXVhZHMuaW5kZXhPZih0aGlzLnF1YWQpLCAxKTtcclxuXHRcdHRoaXMuYXJlYSAmJiB0aGlzLnBhcmVudC5hcmVhcy5zcGxpY2UodGhpcy5wYXJlbnQuYXJlYXMuaW5kZXhPZih0aGlzLmFyZWEpLCAxKTtcclxuXHR9XHJcbn1cclxuXHJcblxyXG5jbGFzcyBMYXllclZ1ZSBleHRlbmRzIFZ1ZUltcGwud2l0aChtYWtlQ2xhc3Moe1xyXG5cdHNvdXJjZTogbnVsbCBhcyBhbnkgYXMgUHJvcE9wdGlvbnNXaXRoPHsgbGF5ZXJzOiBTekxheWVyW10sIHNhdmVkU2hhcGVzOiBzdHJpbmdbXSB9LCBuZXZlciwgdHJ1ZT4sXHJcbn0pKSB7XHJcblx0QFRlbXBsYXRlXHJcblx0Z2V0IF90KCkge1xyXG5cdFx0cmV0dXJuIGBcclxuXHRcdFx0PEFQUD5cclxuXHRcdFx0XHQ8aDE+IFNoYXBlc3Qgdmlld2VyIDwvaDE+XHJcblx0XHRcdFx0PGEtcm93PlxyXG5cdFx0XHRcdFx0PGEtY29sPlxyXG5cdFx0XHRcdFx0XHQ8TGF5ZXJDYW52YXNWdWUgOnNpemU9XCIyNTZcIiA6bGF5ZXJzPVwibGF5ZXJzXCIgLz5cclxuXHRcdFx0XHRcdFx0PHRlbXBsYXRlIHYtZm9yPVwiKGwsIGkpIG9mIGxheWVyc1wiIDprZXk9XCJpICsgaGFzaC5zcGxpdCgnOicpW2ldXCI+XHJcblx0XHRcdFx0XHRcdFx0PGJyIHYtaWY9XCJpICUgMiA9PSAwXCI+XHJcblx0XHRcdFx0XHRcdFx0PExheWVyQ2FudmFzVnVlIDpzaXplPVwiMTI4XCIgOmxheWVyPVwibFwiXHRcdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcdFx0OmNsYXNzPVwibCA9PSBzZWxlY3RlZExheWVyID8gJ3NlbGVjdGVkJyA6ICd1bnNlbGVjdGVkJ1wiXHJcblx0XHRcdFx0XHRcdFx0XHRAY2xpY2s9XCJzZWxlY3RlZExheWVySW5kZXggPSBpXCJcclxuXHRcdFx0XHRcdFx0XHRcdC8+XHJcblx0XHRcdFx0XHRcdDwvdGVtcGxhdGU+XHJcblx0XHRcdFx0XHRcdDxicj5cclxuXHRcdFx0XHRcdFx0PGJ1dHRvbiBAY2xpY2s9XCIke3RoaXMucG9wTGF5ZXJ9XCI+IC0gPC9idXR0b24+XHJcblx0XHRcdFx0XHRcdDxidXR0b24gQGNsaWNrPVwiJHt0aGlzLnB1c2hMYXllcn1cIj4gKyA8L2J1dHRvbj5cclxuXHRcdFx0XHRcdFx0PGJ1dHRvbiBAY2xpY2s9XCJoYXNoID0gaGFzaFwiIDpjbGFzcz1cIlshaXNOb3JtYWxpemVkICYmICdzZWxlY3RlZCddXCI+IOKGuiA8L2J1dHRvbj5cclxuXHRcdFx0XHRcdFx0PGJyPlxyXG5cdFx0XHRcdFx0XHQ8aW5wdXQgOnZhbHVlPVwiJHt0aGlzLmhhc2h9XCIgQGNoYW5nZT1cImhhc2g9JGV2ZW50LnRhcmdldC52YWx1ZVwiIHN0eWxlPVwid2lkdGg6IDEwMCU7Zm9udC1mYW1pbHk6IG1vbm9zcGFjZTtmb250LXNpemU6IHNtYWxsO1wiIC8+XHJcblx0XHRcdFx0XHQ8L2EtY29sPlxyXG5cdFx0XHRcdFx0PGEtY29sPiA8YS1jb2w+XHJcblx0XHRcdFx0XHRcdDx0ZXh0YXJlYSB2LW1vZGVsPVwiY3VzdG9tUXVhZFwiIHN0eWxlPVwicmVzaXplOmJvdGg7d2lkdGg6NDAwcHg7aGVpZ2h0OjIwMHB4XCI+PC90ZXh0YXJlYT5cclxuXHRcdFx0XHRcdFx0PFF1YWRFZGl0b3JWdWVcclxuXHRcdFx0XHRcdFx0XHR2LWZvcj1cIihxdWFkLCBpKSBvZiBzZWxlY3RlZExheWVyPy5xdWFkc1wiIDprZXk9XCJpXCJcclxuXHRcdFx0XHRcdFx0XHQ6cXVhZD1cInF1YWRcIiA6cGFyZW50PVwic2VsZWN0ZWRMYXllclwiIC8+XHJcblx0XHRcdFx0XHRcdDxidXR0b24gQGNsaWNrPVwiJHt0aGlzLnBvcFF1YWR9XCI+IC0gPC9idXR0b24+XHJcblx0XHRcdFx0XHRcdDxidXR0b24gQGNsaWNrPVwiJHt0aGlzLnB1c2hRdWFkfVwiPiArIDwvYnV0dG9uPlxyXG5cdFx0XHRcdFx0PC9hLWNvbD4gPGEtY29sPlxyXG5cdFx0XHRcdFx0XHQ8UXVhZEVkaXRvclZ1ZVxyXG5cdFx0XHRcdFx0XHRcdHYtZm9yPVwiKGFyZWEsIGkpIG9mIHNlbGVjdGVkTGF5ZXI/LmFyZWFzXCIgOmtleT1cImlcIlxyXG5cdFx0XHRcdFx0XHRcdDphcmVhPVwiYXJlYVwiIDpwYXJlbnQ9XCJzZWxlY3RlZExheWVyXCIgLz5cclxuXHRcdFx0XHRcdFx0PGJ1dHRvbiBAY2xpY2s9XCIke3RoaXMucG9wQXJlYX1cIj4gLSA8L2J1dHRvbj5cclxuXHRcdFx0XHRcdFx0PGJ1dHRvbiBAY2xpY2s9XCIke3RoaXMucHVzaEFyZWF9XCI+ICsgPC9idXR0b24+XHJcblx0XHRcdFx0XHQ8L2EtY29sPiA8L2EtY29sPlxyXG5cdFx0XHRcdDwvYS1yb3c+XHJcblx0XHRcdFx0PGEtcm93PlxyXG5cdFx0XHRcdFx0PGJ1dHRvbiBAY2xpY2s9XCJ0aGlzLnNhdmVTaGFwZSgpXCI+IFNhdmUgY3VycmVudCBzaGFwZSA8L2J1dHRvbj5cclxuXHRcdFx0XHRcdDxMYXllckNhbnZhc1Z1ZSA6c2l6ZT1cIjY0XCJcclxuXHRcdFx0XHRcdFx0di1mb3I9XCJoYXNoIG9mICR7dGhpcy5zb3VyY2Uuc2F2ZWRTaGFwZXN9XCJcclxuXHRcdFx0XHRcdFx0Omhhc2g9XCJoYXNoXCIgOmtleT1cImhhc2hcIlxyXG5cdFx0XHRcdFx0XHRAY2xpY2s9XCJ0aGlzLmhhc2ggPSBoYXNoXCJcclxuXHRcdFx0XHRcdFx0QGNvbnRleHRtZW51LnByZXZlbnQ9XCJ1bnNhdmVTaGFwZShoYXNoKVwiIC8+XHJcblx0XHRcdFx0PC9hLXJvdz5cclxuXHRcdFx0XHQ8YS1yb3c+XHJcblx0XHRcdFx0XHQ8TGF5ZXJDYW52YXNWdWUgOnNpemU9XCI2NFwiXHJcblx0XHRcdFx0XHRcdHYtZm9yPVwiKGhhc2gsIG5hbWUpIGluICR7dGhpcy5uYW1lZH1cIlxyXG5cdFx0XHRcdFx0XHQ6dGl0bGU9XCJuYW1lXCJcclxuXHRcdFx0XHRcdFx0Omhhc2g9XCJoYXNoXCIgOmtleT1cImhhc2hcIlxyXG5cdFx0XHRcdFx0XHRAY2xpY2s9XCJ0aGlzLmhhc2ggPSBoYXNoXCJcclxuXHRcdFx0XHRcdFx0QGNvbnRleHRtZW51LnByZXZlbnQ9XCJ1bnNhdmVTaGFwZShoYXNoKVwiIC8+XHJcblx0XHRcdFx0PC9hLXJvdz5cclxuXHRcdFx0PC9BUFA+XHJcblx0XHRgO1xyXG5cdH07XHJcblx0Z2V0IGxheWVycygpIHtcclxuXHRcdHJldHVybiB0aGlzLnNvdXJjZS5sYXllcnM7XHJcblx0fVxyXG5cdHNlbGVjdGVkTGF5ZXJJbmRleCA9IDA7XHJcblx0Z2V0IHNlbGVjdGVkTGF5ZXIoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5sYXllcnNbdGhpcy5zZWxlY3RlZExheWVySW5kZXhdO1xyXG5cdH1cclxuXHJcblx0bW91bnRlZCgpIHtcclxuXHRcdE9iamVjdC5hc3NpZ24oZ2xvYmFsVGhpcywgeyB2aWV3OiB0aGlzIH0pO1xyXG5cdH1cclxuXHJcblx0Y3R4OiBTekNvbnRleHQyRCB8IG51bGwgPSBudWxsO1xyXG5cclxuXHRzZXRGcm9tVG8ocXVhZDogU3pMYXllclF1YWQsIHY6IFtudW1iZXIsIG51bWJlcl0pIHtcclxuXHRcdHF1YWQuZnJvbSA9IHZbMF07XHJcblx0XHRxdWFkLnRvID0gdlsxXTtcclxuXHR9XHJcblxyXG5cdHBvcFF1YWQoKSB7XHJcblx0XHR0aGlzLnNlbGVjdGVkTGF5ZXIucXVhZHMucG9wKCk7XHJcblx0fVxyXG5cdHB1c2hRdWFkKCkge1xyXG5cdFx0bGV0IGZyb20gPSB0aGlzLnNlbGVjdGVkTGF5ZXIucXVhZHMuc2xpY2UoLTEpWzBdPy50byA/PyAwO1xyXG5cdFx0dGhpcy5zZWxlY3RlZExheWVyLnF1YWRzLnB1c2gobmV3IFN6TGF5ZXJRdWFkKHsgZnJvbSwgdG86IGZyb20gKyA2IH0pKTtcclxuXHR9XHJcblx0cG9wQXJlYSgpIHtcclxuXHRcdHRoaXMuc2VsZWN0ZWRMYXllci5hcmVhcy5wb3AoKTtcclxuXHR9XHJcblx0cHVzaEFyZWEoKSB7XHJcblx0XHRsZXQgZnJvbSA9IHRoaXMuc2VsZWN0ZWRMYXllci5hcmVhcy5zbGljZSgtMSlbMF0/LnRvID8/IDA7XHJcblx0XHR0aGlzLnNlbGVjdGVkTGF5ZXIuYXJlYXMucHVzaChuZXcgU3pMYXllckFyZWEoeyBmcm9tLCB0bzogZnJvbSArIDYgfSkpO1xyXG5cdH1cclxuXHJcblx0cG9wTGF5ZXIoKSB7IHRoaXMubGF5ZXJzLnBvcCgpOyB9XHJcblx0cHVzaExheWVyKCkge1xyXG5cdFx0dGhpcy5sYXllcnMucHVzaChcclxuXHRcdFx0U3pMYXllci5mcm9tU2hvcnRLZXkoJ2whenxxIUMtMDYsQy02YyxDLWNpLEMtaW98YSFzdTBvfGMhJylcclxuXHRcdCk7XHJcblx0fVxyXG5cdGdldCBuYW1lZCgpIHtcclxuXHRcdHJldHVybiBbXHJcblx0XHRcdFN6SW5mby5xdWFkLm5hbWVkLFxyXG5cdFx0XHRTekluZm8ucXVhZC5uYW1lZDQsXHJcblx0XHRcdFN6SW5mby5xdWFkLm5hbWVkNixcclxuXHRcdF0uZmxhdE1hcChlID0+IE9iamVjdC52YWx1ZXMoZSkpO1xyXG5cdH1cclxuXHRnZXQgaGFzaCgpIHtcclxuXHRcdHJldHVybiB0aGlzLmxheWVycy5tYXAoZSA9PiBlLmNsb25lKCkuZ2V0SGFzaCgpKS5qb2luKCc6Jyk7XHJcblx0fVxyXG5cdHNldCBoYXNoKHYpIHtcclxuXHRcdHRoaXMuc291cmNlLmxheWVycyA9XHJcblx0XHRcdHYuc3RhcnRzV2l0aCgnc3ohJykgPyB2LnNsaWNlKDMpLnNwbGl0KCc6JykubWFwKFN6TGF5ZXIuZnJvbVNob3J0S2V5KVxyXG5cdFx0XHRcdDogdi5zcGxpdCgnOicpLm1hcChTekxheWVyLmZyb21TaGFwZXpIYXNoKTtcclxuXHR9XHJcblxyXG5cdHNhdmVTaGFwZSgpIHtcclxuXHRcdHRoaXMudW5zYXZlU2hhcGUodGhpcy5oYXNoKTtcclxuXHRcdHRoaXMuc291cmNlLnNhdmVkU2hhcGVzLnB1c2godGhpcy5oYXNoKTtcclxuXHRcdGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdzelNhdmVkU2hhcGVzJywgSlNPTi5zdHJpbmdpZnkodGhpcy5zb3VyY2Uuc2F2ZWRTaGFwZXMpKTtcclxuXHR9XHJcblx0dW5zYXZlU2hhcGUoaGFzaDogc3RyaW5nKSB7XHJcblx0XHRpZiAodGhpcy5zb3VyY2Uuc2F2ZWRTaGFwZXMuaW5jbHVkZXMoaGFzaCkpIHtcclxuXHRcdFx0dGhpcy5zb3VyY2Uuc2F2ZWRTaGFwZXMuc3BsaWNlKHRoaXMuc291cmNlLnNhdmVkU2hhcGVzLmluZGV4T2YoaGFzaCksIDEpO1xyXG5cdFx0XHRsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnc3pTYXZlZFNoYXBlcycsIEpTT04uc3RyaW5naWZ5KHRoaXMuc291cmNlLnNhdmVkU2hhcGVzKSk7XHJcblx0XHR9XHJcblx0fVxyXG5cdGdldCBpc05vcm1hbGl6ZWQoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5sYXllcnMuZXZlcnkoZSA9PiBlLmlzTm9ybWFsaXplZCgpKTtcclxuXHR9XHJcblx0cGF0aCA9IGBcclxuY3R4LmxpbmVUb1IoMC44LCBmcm9tKTtcclxuY3R4LmxpbmVUb1IoTWF0aC5TUVJUMiwgKGZyb20gKyB0bykgLyAyKTtcclxuY3R4LmxpbmVUb1IoMC40LCB0byk7XHJcblx0YC50cmltKCk7XHJcblx0Z2V0IGN1c3RvbVF1YWQoKTogc3RyaW5nIHtcclxuXHRcdHJldHVybiB0aGlzLnBhdGg7XHJcblx0fVxyXG5cdHNldCBjdXN0b21RdWFkKHYpIHtcclxuXHRcdGNvbnNvbGUubG9nKHYpO1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0bGV0IHMgPSBgXHJcblx0XHRcdFx0ZnVuY3Rpb24gZigpIHtcclxuXHRcdFx0XHRcdHJldHVybiAoY3R4LCB7IGZyb20sIHRvIH0pID0+IHtcclxuXHRcdFx0XHRcdFx0JHt2fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRmXHJcblx0XHRcdGA7XHJcblx0XHRcdGxldCBwYXRoID0gZXZhbChzKSgpO1xyXG5cdFx0XHRsZXQgWCA9IFN6SW5mby5xdWFkLmJ5Q2hhci5YO1xyXG5cdFx0XHRjb25zb2xlLmxvZyh7cGF0aH0pO1xyXG5cdFx0XHRYLnBhdGggPSBwYXRoO1xyXG5cdFx0fSBjYXRjaChlKXtcclxuXHRcdFx0Y29uc29sZS5lcnJvcihlKVxyXG5cdFx0fTtcclxuXHRcdHRoaXMuaGFzaCA9IHRoaXMuaGFzaDtcclxuXHRcdHRoaXMucGF0aCA9IHY7XHJcblx0fVxyXG59XHJcblxyXG5jcmVhdGVBcHAoTGF5ZXJWdWUsIGRhdGEpLnVzZShhbnRkKS5tb3VudCgnYm9keScpOyJdfQ==